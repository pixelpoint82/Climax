<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Climax to Earn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* Custom Styles & Animations */
        @import url('https://fonts.googleapis.com/css2?family=Bangers&family=Inter:wght@400;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f0f15;
            color: white;
            overflow: hidden;
            touch-action: manipulation;
        }

        .game-title {
            font-family: 'Bangers', cursive;
            letter-spacing: 2px;
            text-shadow: 3px 3px 0px #000;
        }

        .tap-btn {
            transition: transform 0.05s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            cursor: pointer;
        }

        .tap-btn:active {
            transform: scale(0.9);
        }

        .tap-btn.popped {
            transform: scale(1.1);
        }

        /* Banana Bar Animation */
        .banana-fill {
            transition: height 0.2s ease-out;
        }

        /* Floating Score Text Animation */
        .float-text {
            position: absolute;
            animation: floatUp 0.8s ease-out forwards;
            pointer-events: none;
            font-weight: bold;
            color: #fbbf24;
            text-shadow: 1px 1px 0 #000;
            white-space: nowrap;
            z-index: 40;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-80px) scale(1.5); opacity: 0; }
        }

        /* Shake animation for climax */
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* Silhouette Breathing Animation */
        .breathe {
            animation: breathe 4s ease-in-out infinite;
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.02); opacity: 0.4; }
        }

        /* Toggle Switch */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #fbbf24;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #fbbf24;
        }
    </style>
</head>
<body class="h-screen w-full flex flex-col items-center justify-between relative">

    <!-- Background Gradient -->
    <div class="absolute inset-0 bg-gradient-to-b from-purple-900/40 via-gray-900 to-black z-0 pointer-events-none"></div>

    <!-- Silhouette Background -->
    <div class="absolute inset-0 flex items-end justify-center z-0 pointer-events-none overflow-hidden">
        <svg viewBox="0 0 500 800" class="h-[90%] w-auto opacity-30 breathe drop-shadow-[0_0_15px_rgba(236,72,153,0.3)]" preserveAspectRatio="xMidYMax">
            <defs>
                <linearGradient id="silhouette-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" style="stop-color:#be185d;stop-opacity:1" /> <!-- Pink-700 -->
                    <stop offset="100%" style="stop-color:#7e22ce;stop-opacity:1" /> <!-- Purple-700 -->
                </linearGradient>
            </defs>
            <!-- Artistic Abstract Silhouette Path -->
            <path d="
                M250,100 
                C230,100 215,115 215,140 
                C215,160 225,170 230,180 
                C200,190 180,210 180,250 
                C180,280 190,300 200,320 
                C190,350 170,380 170,420 
                C170,480 210,500 210,500 
                C180,550 160,650 160,800 
                L340,800 
                C340,650 320,550 290,500 
                C290,500 330,480 330,420 
                C330,380 310,350 300,320 
                C310,300 320,280 320,250 
                C320,210 300,190 270,180 
                C275,170 285,160 285,140 
                C285,115 270,100 250,100 
                Z" 
                fill="url(#silhouette-gradient)" />
        </svg>
    </div>

    <!-- Canvas for Confetti -->
    <canvas id="confetti" class="absolute top-0 left-0 w-full h-full pointer-events-none z-50"></canvas>

    <!-- Header / Score -->
    <div class="w-full max-w-md px-6 pt-4 flex flex-col items-center z-10">
        <div class="w-full flex justify-end mb-2">
            <!-- AI Hype Toggle -->
            <div class="flex items-center space-x-2 bg-black/60 p-2 rounded-full border border-purple-500/30 backdrop-blur-sm">
                <span class="text-xs font-bold text-yellow-400 pl-2">‚ú® AI Hype</span>
                <label for="ai-toggle" class="flex items-center cursor-pointer relative">
                    <input type="checkbox" id="ai-toggle" class="sr-only" onchange="toggleAI(this)">
                    <div class="w-10 h-6 bg-gray-600 rounded-full border border-gray-500 toggle-label transition-colors"></div>
                    <div class="dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition-transform transform translate-x-0" id="toggle-dot"></div>
                </label>
            </div>
        </div>

        <h1 class="game-title text-4xl text-yellow-400 mb-2 drop-shadow-md">CLIMAX TO EARN</h1>
        <h3> Dad's will make you feel it DEEP! oh Yes!</h3>
        <!-- Score Board with PHP -->
        <div class="bg-black/60 backdrop-blur border border-purple-500/30 rounded-2xl px-6 py-2 shadow-lg flex flex-col items-center min-w-[180px]">
            <span class="text-xs text-gray-400 uppercase tracking-wider">Current Score</span>
            <span id="score-display" class="text-3xl font-bold font-mono text-white">0</span>
            
            <!-- Peso Display -->
            <div class="flex items-center mt-1 border-t border-gray-700 w-full justify-center pt-1">
                <span class="text-green-500 font-bold mr-1">‚Ç±</span>
                <span id="peso-display" class="text-green-400 font-mono text-lg">0.00</span>
            </div>
        </div>
    </div>

    <!-- Main Game Area -->
    <div class="flex-1 flex flex-col items-center justify-center w-full max-w-md relative z-10">
        
        <!-- Interaction Zone -->
        <div class="relative w-64 h-64 flex items-center justify-center">
            <!-- Ripple/Burst Effect Container -->
            <div id="effects-container" class="absolute inset-0 pointer-events-none"></div>

            <!-- The Finger Button -->
            <button id="tap-button" class="tap-btn text-[8rem] leading-none filter drop-shadow-2xl relative z-20 group">
                <span class="group-hover:brightness-110 transition-all filter drop-shadow-[0_0_10px_rgba(255,255,255,0.3)]">‚òùÔ∏è</span>
            <h4>Chorizo Finger</h4>
            </button>
        </div>

        <div id="status-message" class="h-6 mt-4 flex items-center justify-center bg-black/40 rounded-full px-4 backdrop-blur-sm">
            <p class="text-gray-300 text-sm animate-pulse font-bold" id="instruction-text">Tap the finger!</p>
            <p class="text-yellow-400 text-xs hidden" id="loading-text">‚ú® Generating Hype...</p>
        </div>
    </div>

    <!-- Banana Progress Section -->
    <div class="w-full max-w-md px-6 pb-12 z-10 flex flex-col items-center">
        <div class="flex justify-between w-full mb-2 text-sm font-bold text-gray-300">
            <span class="bg-black/40 px-2 rounded">Arousal Level</span>
            <span id="percent-display" class="bg-black/40 px-2 rounded text-yellow-400">0%</span>
        </div>

        <!-- Banana Shaped Progress Bar using SVG Masking -->
        <div class="relative w-full h-16 drop-shadow-lg transform hover:scale-105 transition-transform duration-300">
            <svg viewBox="0 0 400 60" class="w-full h-full overflow-visible">
                <defs>
                    <!-- Define the Banana Shape Path -->
                    <path id="banana-path" d="M20,40 Q200,80 380,40 Q360,-10 200,30 Q40,-10 20,40 Z" />
                    
                    <!-- Clip Path for the shape -->
                    <clipPath id="banana-clip">
                        <use href="#banana-path" />
                    </clipPath>
                    
                    <!-- Gradient for the fill -->
                    <linearGradient id="banana-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#facc15;stop-opacity:1" />
                        <stop offset="50%" style="stop-color:#fbbf24;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#f59e0b;stop-opacity:1" />
                    </linearGradient>
                </defs>

                <!-- Background Track (Empty Banana) -->
                <use href="#banana-path" fill="#1f2937" stroke="#4b5563" stroke-width="2" />

                <!-- Foreground Fill (The Actual Progress) -->
                <g clip-path="url(#banana-clip)">
                    <rect id="progress-fill" x="0" y="-50" width="100%" height="200" fill="url(#banana-gradient)" transform="translateX(-100%)" transition="transform 0.1s linear" />
                    <rect x="0" y="-50" width="100%" height="200" fill="white" fill-opacity="0.1" transform="translateX(-100%)" id="shine-fill" />
                </g>
                
                <!-- Outline on top -->
                <use href="#banana-path" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="2" pointer-events="none" />
            </svg>
        </div>
    </div>

    <!-- Climax / Game Over Modal -->
    <div id="modal-overlay" class="fixed inset-0 bg-black/90 z-50 flex items-center justify-center hidden opacity-0 transition-opacity duration-300">
        <div class="bg-gray-800 border-2 border-yellow-400 p-8 rounded-3xl max-w-sm w-full mx-4 text-center transform scale-90 transition-transform duration-300 relative overflow-hidden shadow-2xl" id="modal-content">
            
            <!-- AI Sparkles Background -->
            <div class="absolute -top-10 -right-10 w-32 h-32 bg-yellow-500/20 rounded-full blur-3xl pointer-events-none"></div>
            
            <div class="text-6xl mb-4 relative z-10">üí¶üçå</div>
            <h2 class="text-4xl font-black text-yellow-400 mb-2 game-title relative z-10">CLIMAX REACHED!</h2>
            
            <!-- AI Generated Reward Section -->
            <div class="min-h-[80px] flex items-center justify-center mb-6 relative z-10">
                <p class="text-gray-300 italic" id="reward-text">You handled that perfectly.</p>
                <div id="reward-loader" class="hidden">
                    <span class="flex items-center text-yellow-400 text-sm">
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Asking the Oracle...
                    </span>
                </div>
            </div>
            
            <div class="bg-gray-900 rounded-lg p-4 mb-6 relative z-10 border border-gray-700">
                <div class="flex justify-between items-end border-b border-gray-700 pb-2 mb-2">
                    <span class="text-sm text-gray-400">Final Score</span>
                    <span class="text-xl font-mono text-white" id="final-score">0</span>
                </div>
                <div class="flex justify-between items-end">
                    <span class="text-sm text-gray-400">Total Earned</span>
                    <span class="text-2xl font-mono text-green-400 font-bold">‚Ç±<span id="final-peso">0.00</span></span>
                </div>
            </div>

            <button onclick="resetGame()" class="w-full bg-yellow-400 hover:bg-yellow-300 text-black font-bold py-4 rounded-xl text-xl shadow-lg transform active:scale-95 transition-all relative z-10">
                Go Again?
            </button>
        </div>
    </div>

    <script>
        // --- Configuration & State ---
        const apiKey = ""; // System will provide key at runtime
        const exchangeRate = 2.00; // 5 Pesos per tap
        
        let score = 0;
        let progress = 0;
        let isGameOver = false;
        const maxScoreForClimax = 100;
        let aiEnabled = false;

        // Default phrases vs AI phrases
        const defaultPhrases = ["+1", "YES", "GOOD", "KEEP GOING", "FASTER", "NICE"];
        let currentPhrases = [...defaultPhrases];
        let aiPhrasesCache = [];

        // --- DOM Elements ---
        const tapBtn = document.getElementById('tap-button');
        const scoreDisplay = document.getElementById('score-display');
        const pesoDisplay = document.getElementById('peso-display');
        const percentDisplay = document.getElementById('percent-display');
        const progressFill = document.getElementById('progress-fill');
        const shineFill = document.getElementById('shine-fill');
        const modalOverlay = document.getElementById('modal-overlay');
        const modalContent = document.getElementById('modal-content');
        const finalScoreDisplay = document.getElementById('final-score');
        const finalPesoDisplay = document.getElementById('final-peso');
        const instructionText = document.getElementById('instruction-text');
        const rewardText = document.getElementById('reward-text');
        const rewardLoader = document.getElementById('reward-loader');
        const loadingText = document.getElementById('loading-text');
        const toggleDot = document.getElementById('toggle-dot');

        // --- Audio Context ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playTapSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.frequency.setValueAtTime(400 + Math.random() * 200, audioCtx.currentTime);
            osc.type = 'sine';
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        function playClimaxSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.frequency.setValueAtTime(200, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(800, audioCtx.currentTime + 0.5);
            osc.type = 'triangle';
            gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 1.5);
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 1.5);
        }

        // --- Game Logic ---

        function handleTap(e) {
            if (isGameOver) return;

            if (score === 0) {
                instructionText.style.opacity = '0';
            }

            score++;
            let progressIncrement = (100 / maxScoreForClimax); 
            if (Math.random() > 0.9) progressIncrement *= 3; // Critical hit
            progress = Math.min(progress + progressIncrement, 100);

            // Update UI
            updateDisplay();
            
            // Animation values
            const translateVal = -100 + progress;
            progressFill.setAttribute('transform', `translateX(${translateVal}%)`);
            shineFill.setAttribute('transform', `translateX(${translateVal}%)`);

            // Effects
            playTapSound();
            createFloatingText(e.clientX || (window.innerWidth/2), e.clientY || (window.innerHeight/2));
            animateButton();

            if (progress >= 100) {
                triggerClimax();
            }
        }

        function updateDisplay() {
            scoreDisplay.textContent = score;
            const pesoValue = (score * exchangeRate).toFixed(2);
            pesoDisplay.textContent = pesoValue;
            percentDisplay.textContent = Math.floor(progress) + '%';
        }

        function animateButton() {
            tapBtn.classList.remove('popped');
            void tapBtn.offsetWidth; 
            tapBtn.classList.add('popped');
        }

        function createFloatingText(x, y) {
            const el = document.createElement('div');
            el.classList.add('float-text');
            
            // Choose text source
            let textPool = aiEnabled && aiPhrasesCache.length > 0 ? aiPhrasesCache : defaultPhrases;
            let text = textPool[Math.floor(Math.random() * textPool.length)];

            el.textContent = text;
            
            // Randomize styling slightly
            if (aiEnabled) {
                el.style.color = Math.random() > 0.5 ? '#fbbf24' : '#d946ef'; // Yellow or Fuchsia
                el.style.fontSize = (1.2 + Math.random() * 0.5) + 'rem';
                el.style.textShadow = '0 0 10px rgba(255,255,255,0.5)';
            }

            el.style.left = (x - 20 + Math.random() * 40) + 'px';
            el.style.top = (y - 100) + 'px';
            
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        function triggerClimax() {
            isGameOver = true;
            playClimaxSound();
            document.body.classList.add('shake');
            setTimeout(() => document.body.classList.remove('shake'), 500);
            startConfetti();

            // Generate AI Reward if enabled or just always try to generate one for the finale
            generateVictoryMessage();

            setTimeout(() => {
                finalScoreDisplay.textContent = score;
                finalPesoDisplay.textContent = (score * exchangeRate).toFixed(2);
                
                modalOverlay.classList.remove('hidden');
                void modalOverlay.offsetWidth;
                modalOverlay.classList.remove('opacity-0');
                modalContent.classList.remove('scale-90');
                modalContent.classList.add('scale-100');
            }, 800);
        }

        function resetGame() {
            score = 0;
            progress = 0;
            isGameOver = false;
            
            updateDisplay();
            
            progressFill.setAttribute('transform', `translateX(-100%)`);
            shineFill.setAttribute('transform', `translateX(-100%)`);
            
            rewardText.textContent = "Ready for another round?"; // Reset text
            
            modalOverlay.classList.add('opacity-0');
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-90');
            
            setTimeout(() => {
                modalOverlay.classList.add('hidden');
                stopConfetti();
                instructionText.style.opacity = '1';
            }, 300);
        }

        // --- Gemini API Integration ---

        async function callGemini(prompt) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });

                if (!response.ok) throw new Error('API Error');
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Gemini Error:", error);
                return null;
            }
        }

        async function fetchHypePhrases() {
            if (!apiKey) return;
            loadingText.classList.remove('hidden');
            
            const prompt = `
                You are a hype-man for a tapping game called "Climax to Earn" involving a banana.
                Generate a JSON list of 20 short, punchy, enthusiastic, 1-3 word exclamations.
                They should be funny, high energy, and use double-entendres (like "Faster!", "Squeeze it!", "So hard!", "Explosive!").
                Strictly SFW (Safe For Work) but cheeky.
                Return ONLY the raw JSON array of strings, no markdown.
            `;

            const result = await callGemini(prompt);
            loadingText.classList.add('hidden');

            if (result) {
                try {
                    // Cleanup potential markdown formatting
                    const cleanJson = result.replace(/```json/g, '').replace(/```/g, '').trim();
                    const phrases = JSON.parse(cleanJson);
                    if (Array.isArray(phrases)) {
                        aiPhrasesCache = phrases;
                    }
                } catch (e) {
                    console.log("Failed to parse phrases");
                }
            }
        }

        async function generateVictoryMessage() {
            // Reset UI
            rewardText.classList.add('hidden');
            rewardLoader.classList.remove('hidden');

            const prompt = `
                The user just won the "Climax to Earn" game by tapping furiously to fill a banana meter.
                Write a short, witty, 2-sentence congratulatory message. 
                It should be a "Performance Review" of their finger work.
                Use subtle double entendres but keep it SFW.
                Examples: "Your finger stamina is legendary.", "That was a truly explosive finish."
            `;

            const text = await callGemini(prompt);
            
            rewardLoader.classList.add('hidden');
            rewardText.classList.remove('hidden');
            
            if (text) {
                rewardText.textContent = text;
            } else {
                rewardText.textContent = "You handled that perfectly. (AI was too shy to comment)";
            }
        }

        function toggleAI(checkbox) {
            aiEnabled = checkbox.checked;
            const dot = document.getElementById('toggle-dot');
            
            if (aiEnabled) {
                dot.classList.add('translate-x-4');
                // Fetch phrases immediately if empty
                if (aiPhrasesCache.length === 0) {
                    fetchHypePhrases();
                }
            } else {
                dot.classList.remove('translate-x-4');
            }
        }

        // --- Event Listeners ---
        tapBtn.addEventListener('mousedown', (e) => handleTap(e));
        tapBtn.addEventListener('touchstart', (e) => {
            e.preventDefault(); 
            for (let i = 0; i < e.changedTouches.length; i++) {
                handleTap(e.changedTouches[i]);
            }
        }, { passive: false });

        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.code === 'Enter') {
                const rect = tapBtn.getBoundingClientRect();
                handleTap({ clientX: rect.left + rect.width/2, clientY: rect.top + rect.height/2 });
            }
        });

        // --- Canvas Confetti ---
        const canvas = document.getElementById('confetti');
        const ctx = canvas.getContext('2d');
        let particles = [];
        let animationId;

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        class Particle {
            constructor() {
                this.x = canvas.width / 2;
                this.y = canvas.height / 2;
                this.vx = (Math.random() - 0.5) * 20;
                this.vy = (Math.random() - 0.5) * 20;
                this.life = 100 + Math.random() * 100;
                this.color = `hsl(${Math.random() * 60 + 40}, 100%, 50%)`; 
                this.size = Math.random() * 10 + 5;
                this.gravity = 0.5;
            }
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += this.gravity;
                this.life--;
                this.size *= 0.96;
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.size, this.size);
            }
        }

        function loopConfetti() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (particles.length < 300) {
                 for(let i=0; i<5; i++) particles.push(new Particle());
            }
            particles.forEach((p, index) => {
                p.update();
                p.draw();
                if (p.life <= 0 || p.size < 0.5) particles.splice(index, 1);
            });
            if (particles.length > 0 || isGameOver) {
                animationId = requestAnimationFrame(loopConfetti);
            }
        }

        function startConfetti() {
            particles = [];
            for (let i = 0; i < 100; i++) particles.push(new Particle());
            cancelAnimationFrame(animationId);
            loopConfetti();
        }

        function stopConfetti() {
            particles = [];
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            cancelAnimationFrame(animationId);
        }

    </script>
</body>
</html>
